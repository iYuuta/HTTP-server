<!DOCTYPE html>
<html lang="en" class="h-full">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Webserver Test Panel</title>
	<meta name="color-scheme" content="light dark" />
	<link rel="stylesheet" href="style.css" />
</head>

<body>
	<header class="site-header">
		<div class="container header-inner">
			<div class="brand">
				<span class="brand-icon">
					<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
						stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
							d="M3 7h18M3 12h18M3 17h18" />
					</svg>
				</span>
				<h1 class="title">Webserver Functionality Test</h1>
			</div>
			<nav class="nav">
				<a class="nav-link" href="about.html">About</a>
				<a class="nav-link" href="contact.html">Contact</a>
				<a class="nav-link" href="gallery.html">Gallery</a>
			</nav>
		</div>
	</header>

	<main class="container">
		<div class="info-box">
			Use these controls to verify GET, POST (CGI), file uploads, DELETE, and redirects on your webserver.
		</div>

		<div class="grid grid-2">
			<!-- GET Request -->
			<section class="card">
				<div class="section-title">
					<span class="icon blue">
						<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
							<path
								d="M12 3l-4 4h3v7h2V7h3l-4-4Zm7 16H5v-2H3v2a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-2h-2v2Z" />
						</svg>
					</span>
					<h2 class="h2">GET Request Test</h2>
				</div>
				<form id="getForm" onsubmit="submitGet(event)" class="form">
					<div>
						<label for="getPath" class="label">Path to GET</label>
						<input id="getPath" type="text" placeholder="/images/image1.jpg" class="input" />
					</div>
					<button type="submit" class="btn btn-blue">
						<svg xmlns="http://www.w3.org/2000/svg" class="icon-inline" viewBox="0 0 24 24"
							fill="currentColor">
							<path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm1 14.59L8.41 12 13 7.41V16.6Z" />
						</svg>
						Send GET
					</button>
				</form>
			</section>

			<!-- CGI: GET or POST or DELETE -->
			<section class="card">
				<div class="section-title">
					<span class="icon emerald">
						<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
							<path
								d="M3 6a3 3 0 0 1 3-3h4l2 2h6a3 3 0 0 1 3 3v1H3V6Zm0 3h18v9a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V9Zm4 2v2h10v-2H7Z" />
						</svg>
					</span>
					<h2 class="h2">CGI Request (GET / POST / DELETE)</h2>
				</div>
				<form id="cgiForm" method="post" onsubmit="submitCgi(event)" class="form">
					<div>
						<label for="cgi-script" class="label">Choose CGI script</label>
						<select id="cgi-script" onchange="updateAction()" class="select">
							<option value="/cgi-bin/python-cgi.py">python-cgi.py</option>
							<option value="/cgi-bin/bash-cgi.sh">bash-cgi.sh</option>
							<option value="/cgi-bin/php-cgi.php">php-cgi.php</option>
						</select>
					</div>
					<div>
						<label for="cgi-method" class="label">HTTP Method</label>
						<select id="cgi-method" class="select">
							<option value="GET">GET</option>
							<option value="POST" selected>POST</option>
							<option value="DELETE">DELETE</option>
						</select>
					</div>
					<div class="grid grid-2-sm">
						<div>
							<label for="name" class="label">Name</label>
							<input id="name" type="text" name="name" required class="input" />
						</div>
						<div class="span-2">
							<label for="message" class="label">Message</label>
							<textarea id="message" name="message" rows="4" class="textarea"></textarea>
						</div>
					</div>
					<button type="submit" class="btn btn-emerald">
						<svg xmlns="http://www.w3.org/2000/svg" class="icon-inline" viewBox="0 0 24 24"
							fill="currentColor">
							<path d="M5 12h14v2H5v-2Zm0-4h14v2H5V8Zm0 8h14v2H5v-2Z" />
						</svg>
						Send to CGI
					</button>
					<pre id="cgiResult" class="codebox"></pre>
				</form>
			</section>

			<!-- File Upload to arbitrary path (like GET) -->
			<section class="card">
				<div class="section-title">
					<span class="icon purple">
						<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
							<path
								d="M19 15v4H5v-4H3v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4h-2Zm-6-1 4-4-1.41-1.41L13 10.17V2h-2v8.17L8.41 8.59 7 10l6 6Z" />
						</svg>
					</span>
					<h2 class="h2">Upload File (choose endpoint)</h2>
				</div>
				<form id="uploadForm" action="/uploads" method="post" enctype="multipart/form-data" class="form">
					<div>
						<label for="uploadPath" class="label">Endpoint path</label>
						<input type="text" id="uploadPath" placeholder="/uploads" value="/uploads" class="input"
							oninput="updateUploadAction()" />
					</div>
					<div>
						<label for="file" class="label">Choose a file</label>
						<input type="file" name="file" id="file" class="input-file" />
					</div>
					<button type="submit" class="btn btn-purple">
						<svg xmlns="http://www.w3.org/2000/svg" class="icon-inline" viewBox="0 0 24 24"
							fill="currentColor">
							<path d="M5 20h14v-2H5v2ZM11 4v8.17L8.41 9.59 7 11l5 5 5-5-1.41-1.41L13 12.17V4h-2Z" />
						</svg>
						Upload
					</button>
				</form>
			</section>

			<!-- DELETE Request via JS (choose path like GET) -->
			<section class="card">
				<div class="section-title">
					<span class="icon rose">
						<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
							<path d="M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12ZM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4Z" />
						</svg>
					</span>
					<h2 class="h2">DELETE Request (choose path)</h2>
				</div>
				<div class="form">
					<div>
						<label for="delPath" class="label">Path to DELETE</label>
						<input type="text" id="delPath" placeholder="/uploads/example.txt" class="input" />
					</div>
					<button onclick="sendDelete()" class="btn btn-rose">
						<svg xmlns="http://www.w3.org/2000/svg" class="icon-inline" viewBox="0 0 24 24"
							fill="currentColor">
							<path
								d="M9 3h6l1 1h4v2H4V4h4l1-1Zm-1 8h2v6H8v-6Zm6 0h2v6h-2v-6ZM6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12Z" />
						</svg>
						Send DELETE
					</button>
					<pre id="deleteResult" class="codebox"></pre>
				</div>
			</section>

			<!-- Redirect Test -->
			<section class="card">
				<div class="section-title">
					<span class="icon amber">
						<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
							<path d="M10 19l7-7-7-7v14Zm-6 0V5h2v14H4Z" />
						</svg>
					</span>
					<h2 class="h2">Redirect Test</h2>
				</div>
				<form action="/redirect" method="get">
					<button type="submit" class="btn btn-amber">
						<svg xmlns="http://www.w3.org/2000/svg" class="icon-inline" viewBox="0 0 24 24"
							fill="currentColor">
							<path d="M13 5l7 7-7 7v-4H4v-6h9V5Z" />
						</svg>
						Go to /redirect
					</button>
				</form>
			</section>
		</div>
	</main>

	<!-- Footer removed -->

	<script>
		function updateAction() {
			const select = document.getElementById("cgi-script");
			const form = document.getElementById("cgiForm");
			if (select && form) form.action = select.value;
		}

		async function submitCgi(e) {
			e.preventDefault();
			const form = document.getElementById('cgiForm');
			const methodSel = document.getElementById('cgi-method');
			const result = document.getElementById('cgiResult');
			const name = document.getElementById('name');
			const message = document.getElementById('message');
			if (!form || !methodSel || !result || !name) return;
			const action = form.action || document.getElementById('cgi-script')?.value || '/cgi-bin/python-cgi.py';
			const method = (methodSel.value || 'POST').toUpperCase();
			result.textContent = 'Sending request...';
			try {
				let res;
				if (method === 'DELETE') {
					// Encode fields into query string for DELETE
					const params = new URLSearchParams();
					params.set('name', name.value || '');
					params.set('message', message.value || '');
					const url = action + (action.includes('?') ? '&' : '?') + params.toString();
					res = await fetch(url, { method: 'DELETE' });
				} else {
					// Default POST as application/x-www-form-urlencoded
					const body = new URLSearchParams();
					body.set('name', name.value || '');
					body.set('message', message.value || '');
					res = await fetch(action, {
						method: 'POST',
						headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
						body: body.toString(),
					});
				}
				const text = await res.text();
				result.textContent = `Status: ${res.status}\n\n${text}`;
			} catch (err) {
				result.textContent = 'Error: ' + (err?.message || String(err));
			}
		}

		function updateUploadAction() {
			const input = document.getElementById('uploadPath');
			const form = document.getElementById('uploadForm');
			if (!input || !form) return;
			let path = (input.value || '').trim();
			if (!path) return; // leave previous action
			if (!path.startsWith('/')) path = '/' + path;
			form.action = path;
		}

		function submitGet(e) {
			e.preventDefault();
			const input = document.getElementById('getPath');
			if (!input) return;
			let path = (input.value || '').trim();
			if (!path) {
				input.focus();
				input.classList.add('input-error');
				setTimeout(() => input.classList.remove('input-error'), 800);
				return;
			}
			if (!path.startsWith('/')) path = '/' + path; // ensure absolute path
			window.location.href = path;
		}

		async function sendDelete() {
			const file = document.getElementById('delPath').value.trim();
			const result = document.getElementById('deleteResult');
			if (!file) {
				result.innerText = 'Please enter a file name.';
				return;
			}
			result.innerText = 'Sending request...';
			try {
				let path = file;
				if (!path.startsWith('/')) path = '/' + path;
				const res = await fetch(path, { method: 'DELETE' });
				const text = await res.text();
				result.innerText = `Status: ${res.status}\n\n${text}`;
			} catch (e) {
				result.innerText = 'Error sending DELETE: ' + e.message;
			}
		}

		document.addEventListener('DOMContentLoaded', () => {
			updateAction();
		});
	</script>
</body>

</html>